# JS 模块化

## 课程目标

- 理解模块化发展过程，解决的痛点
- 了解各种模块化方案，熟悉其实现原理
- 依据面试题目，熟悉巩固模块化相关的知识

## 知识要点

### 概念

随着前端的快速发展，代码越来越复杂。需要更好的代码管理，组织，通信的方案。
模块本质上就是一种提供对外通信的接口，进行代码切分管理的方式。

### 模块化发展进程

1. 使用函数利用作用域进行划分
2. 命名空间
3. 使用闭包进行封装 (IIFE)

```js
(function (global, $) {})(window, jquery);
```

主要使用的模块化方案:
Node: CommonJS -> 逐渐在往 ESM 方向进行转变
浏览器端: ESM

其他模块化方案：AMD, CMD, UMD

#### CommonJS --> [[Node.js 介绍]]

CommonJS 是同步方案

文件是一种模块，内置 **module**, **require**两个变量 `(exports = module.exports)`
导入导出的机制构成了模块最基本的结构

循环引用问题
因为 CommonJs 是同步执行的，而且是值拷贝
在引用的时候，只执行已经输出的部分，忽略未执行的部分
其中 Require 存在缓存机制，之后执行的时候如果有缓存的化会直接返回

#### ESM

ESM 是异步方案，而且是引用传递
在执行的时候如果未执行完，则会打上一个类似于拉取中的 Tag。当执行完毕后，因其是引用类型，直接更新掉值即可。
同样存在缓存机制。

#### AMD 异步方案

依赖前置 -> 在声明阶段即声明所有依赖

#### CMD 异步方案

依赖后置（按需导入依赖） -> 可以在模块代码中按需进行依赖导入

## 补充知识点

#### 闭包的概念和使用

概念：在函数的作用域外依旧持有当前作用域的访问权限。
函数一般存在栈内存中，闭包既然可以访问到函数的作用域，所以闭包是怎么做到的？
闭包存在堆里，栈中的函数持有对堆的引用，因此等函数执行完成出栈以后，闭包依然是可访问的。

逃逸分析：浏览器分析哪些变量以后可能还会被用到。

#### 同步和异步的区别

异步更多的与回调函数，发布订阅有关，同步则是顺序执行。同步可能会阻塞，而异步不会。

#### AMD, CMD 的大概实现思想

define 函数主要的作用是定义模块, 提取依赖（定义一个 Map 存起来），真正加载的时候是在 Require 的时候

#### 主要面试题

CommonJs, ESM, AMD, CMD 大概的使用方法。（AMD, CMD 大概掌握即可）
CommonJs, ESM 分别是引用传递还是值传递，是同步还是异步，为什么？(见上文)
CommonJs, ESM 分别怎么解决循环引用的问题? (中断执行，只输出目前输入的值，再次引入存在缓存机制)

#### 跨平台，跨端低代码解决方案

运行时解决方案：使用一套通用的配置或者代码（JSON，对象），然后根据各种平台写各种的解析器，通过其针对不同的平台生成相应的代码。
编译时解决方案：通过 AST 分析，直接进行分析生成相应的各平台代码。
